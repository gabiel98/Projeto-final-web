<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Editar Usu치rio</title>
  <link rel="stylesheet" href="/css/editUsuario.css">
</head>

<body>

  <%- include('partials/header') %>

  <main class="form-container">

    <h1 class="form-title">Editar Usu치rio</h1>

    <form class="form-card" action="/users/<%= user._id %>/update" method="POST">

      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>

      <div class="form-group">
        <label>Nome</label>
        <input type="text" name="nome_usuario" value="<%= user.nome %>" required>
      </div>

      <div class="form-group">
        <label>Cargo (apenas para funcion치rios)</label>
        <select name="cargo_usuario">
          <option value="">Selecione (obrigat칩rio para funcion치rios)</option>
          <% (cargosPermitidos || []).forEach(function(c) { %>
            <option value="<%= c %>" 
              <%= (user.cargo && user.cargo.toLowerCase() === c.toLowerCase()) ? 'selected' : '' %>>
              <%= c %>
            </option>
          <% }) %>
        </select>
      </div>

      <% if (typeof userRole !== 'undefined' && userRole === 'dono') { %>
        <div class="form-group">
          <label>Permiss칚o</label>
          <select name="role">
            <option value="comprador" <%= user.role === 'comprador' ? 'selected' : '' %>>Comprador</option>
            <option value="funcionario" <%= user.role === 'funcionario' ? 'selected' : '' %>>Funcion치rio</option>
            <option value="dono" <%= user.role === 'dono' ? 'selected' : '' %>>Dono</option>
          </select>
        </div>
      <% } %>

      <% if (typeof query !== 'undefined' && query.erro === 'cargo_invalido') { %>
        <p class="form-error">Escolha um cargo v치lido para funcion치rios.</p>
      <% } %>

      <div class="form-actions">
        <button type="submit" class="btn-primary">游 Salvar Altera칞칫es</button>
        <a href="/users" class="btn-secondary">Cancelar</a>
      </div>

    </form>

  </main>

  <%- include('partials/footer') %>

</body>
</html>
