<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title><%= product ? 'Editar' : 'Novo' %> Produto</title>
  <link rel="stylesheet" href="/css/productForm.css">
</head>
<body>
  <%- include('partials/header') %>

  <main class="product-form-container">
    <h1><%= product ? 'Editar' : 'Novo' %> Produto</h1>

    <form 
      action="<%= product ? ('/products/' + product._id + '/update') : '/products' %>" 
      method="POST" 
      enctype="multipart/form-data"
      class="product-form"
    >
      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>

      <div class="form-group">
        <label>Título do Produto</label>
        <input type="text" name="nome" value="<%= product ? product.nome : '' %>" required />
      </div>

      <div class="form-group">
        <label>Preço (R$)</label>
        <input type="number" step="0.01" name="preco" value="<%= product ? product.preco : '' %>" required />
      </div>

      <div class="form-group">
        <label>Estoque</label>
        <input type="number" name="estoque" value="<%= product ? product.estoque : 0 %>" required />
      </div>

      <div class="form-group">
        <label>Tipo de Produto</label>
        <select name="tipo" required>
          <% (tiposProduto || []).forEach(function(t) { %>
            <option value="<%= t %>" <%= (product && product.tipo === t) ? 'selected' : '' %>>
              <%= t %>
            </option>
          <% }) %>
        </select>
      </div>

      <div class="form-group">
        <label>Descrição</label>
        <textarea name="descricao" rows="4"><%= product ? product.descricao : '' %></textarea>
      </div>

      <div class="form-group">
        <label>Imagem do Produto</label>
        <input type="file" name="imagem" accept="image/*" />

        <% if (product && product.imagem) { %>
          <div class="image-preview">
            <p>Imagem atual:</p>
            <img src="<%= product.imagem %>" alt="<%= product.nome %>" />
          </div>
        <% } %>
      </div>

      <button type="submit" class="btn-primary">Salvar</button>
    </form>

    <p class="back-link">
      <a href="/">← Voltar à loja</a>
    </p>
  </main>

  <%- include('partials/footer') %>
</body>
</html>
