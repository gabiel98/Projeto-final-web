<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title><%= product ? 'Editar' : 'Novo' %> Produto</title>
</head>
<body>
  <%- include('partials/header') %>
  <main>
    <h1><%= product ? 'Editar' : 'Novo' %> Produto</h1>
    <form action="<%= product ? ('/products/' + product._id + '/update') : '/products' %>" method="POST" enctype="multipart/form-data">
      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } %>
      <div>
        <label>Título do Produto</label>
        <input type="text" name="nome" value="<%= product ? product.nome : '' %>" required />
      </div>
      <div>
        <label>Preço (R$)</label>
        <input type="number" step="0.01" name="preco" value="<%= product ? product.preco : '' %>" required />
      </div>
      <div>
        <label>Estoque</label>
        <input type="number" name="estoque" value="<%= product ? product.estoque : 0 %>" required />
      </div>
      <div>
        <label>Tipo de Produto</label>
        <select name="tipo" required>
          <% (tiposProduto || []).forEach(function(t) { %>
            <option value="<%= t %>" <%= (product && product.tipo === t) ? 'selected' : '' %>><%= t %></option>
          <% }) %>
        </select>
      </div>
      <div>
        <label>Descrição</label>
        <textarea name="descricao" rows="4"><%= product ? product.descricao : '' %></textarea>
      </div>
      <div>
        <label>Imagem do Produto</label>
        <input type="file" name="imagem" accept="image/*" />
        <% if (product && product.imagem) { %>
          <p>Imagem atual: <img src="<%= product.imagem %>" alt="<%= product.nome %>" style="max-width:150px;display:block;margin-top:8px" /></p>
        <% } %>
      </div>
      <button type="submit">Salvar</button>
    </form>
    <p><a href="/">Voltar à loja</a></p>
  </main>
  <%- include('partials/footer') %>
</body>
</html>
