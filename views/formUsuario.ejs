<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="utf-8" />
		<title>Adicionar Usuário</title>
		<link rel="stylesheet" href="/css/formUsuario.css">
	</head>
	<body>
		<%- include('partials/header') %>
		<!-- Formulário para criar novo usuário -->
		<h1>Adicionar Usuário</h1>
		<form class="form-addUser" action="/users" method="POST">
			<% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
				<input type="hidden" name="_csrf" value="<%= csrfToken %>" />
			<% } %>
			<div>
				<label for="nome">Nome do Usuário:</label>
				<input type="text" id="nome" name="nome_usuario" required />
			</div>

			<!-- Campos opcionais para autenticação -->
			<div>
				<label for="email">Email (obrigatório):</label>
				<input type="email" id="email" name="email_usuario" required />
			</div>
			<div>
				<label for="senha">Senha (obrigatório):</label>
				<input type="password" id="senha" name="senha_usuario" required />
			</div>

			<% if (typeof userRole !== 'undefined' && userRole === 'dono') { %>
			<div>
				<label for="cargo">Cargo (apenas para funcionários):</label>
				<select id="cargo" name="cargo_usuario">
					<option value="">Selecione (obrigatório para funcionários)</option>
					<% (cargosPermitidos || []).forEach(function(c) { %>
						<option value="<%= c %>"><%= c %></option>
					<% }) %>
				</select>
			</div>

			<div>
				<label for="role">Permissão:</label>
					<select id="role" name="role">
						<option value="comprador" selected>Comprador</option>
						<option value="funcionario">Funcionário</option>
						<option value="dono">Dono</option>
					</select>
				</div>
			<% } %>
			
			<% if (typeof query !== 'undefined') { %>
				<% if (query.erro === 'falta_email_ou_senha') { %>
					<p style="color: red">Preencha nome, email e senha.</p>
				<% } else if (query.erro === 'email_ja_cadastrado') { %>
					<p style="color: red">Este email já está cadastrado.</p>
				<% } else if (query.erro === 'cargo_invalido') { %>
					<p style="color: red">Escolha um cargo válido para funcionários.</p>
				<% } %>
			<% } %>

			<button class="btn-addUser" type="submit">Adicionar Usuário</button>
		</form>

		<p class="back-list"><a href="/users">Voltar para lista</a></p>
	</body>
	<%- include('partials/footer') %>
</html>