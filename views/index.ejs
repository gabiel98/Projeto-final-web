<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Produtos</title>
  <!-- Estilos podem ser movidos para um arquivo CSS separado -->
</head>
<body>
  <%- include('partials/header') %>
  <main>
    <h1>PokeShop ‚Äî Itens Pok√©mon</h1>
    <p>Itens e colecion√°veis do universo Pok√©mon.</p>
    <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
      <p>Conectado como: <strong><%= userName %></strong><% if (typeof userCargo !== 'undefined' && userCargo) { %> (<%= userCargo %>)<% } %></p>
    <% } else { %>
      <p><a href="/login">Fa√ßa login</a> ou <a href="/users/new">crie sua conta</a> para aproveitar mais recursos.</p>
    <% } %>
    <p><a href="/cart">Ir para o carrinho</a></p>
    <div class="grid">
      <% produtos.forEach(function(p) { %>
        <div class="card">
          <% if (p.imagem) { %>
            <img src="<%= p.imagem %>" alt="<%= p.nome %>" style="max-width:100%;height:auto;border-radius:4px;margin-bottom:8px" />
          <% } %>
          <h3><%= p.nome %></h3>
          <div class="price">R$ <%= typeof p.preco === 'number' ? p.preco.toFixed(2) : p.preco %></div>
          <p><strong>Tipo:</strong> <%= p.tipo || 'Outro' %></p>
          <p><strong>Estoque:</strong> <%= p.estoque || 0 %> unidades</p>
          <p><%= p.descricao %></p>
          <div style="margin-top:8px">
            <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
              <form action="/cart/add" method="POST" style="display:inline">
                <input type="hidden" name="productId" value="<%= p._id %>" />
                <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <% } %>
                <button type="submit">Adicionar ao carrinho</button>
              </form>
            <% } %>
            <% if (typeof userRole !== 'undefined' && (userRole === 'dono' || userRole === 'funcionario')) { %>
              <a href="/products/<%= p._id %>/edit"><button>‚úèÔ∏è Editar</button></a>
              <form action="/products/<%= p._id %>/delete" method="POST" style="display:inline">
                <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <% } %>
                <button type="submit" style="color:red">üóëÔ∏è Excluir</button>
              </form>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>
    <% if (typeof userRole !== 'undefined' && (userRole === 'dono' || userRole === 'funcionario')) { %>
      <p><a href="/products/new">‚ûï Adicionar novo produto</a></p>
    <% } %>
  </main>
  <%- include('partials/footer') %>
</body>
</html>
