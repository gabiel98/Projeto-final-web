<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>PokeShop</title>
  <link rel="stylesheet" href="/css/index.css"></head>
<body>

  <%- include('partials/header') %>

  <main class="products-container">

    <header class="products-header">
      <h1>PokeShop - Itens Pok√©mon</h1>
      <p>Itens e colecion√°veis do universo Pok√©mon.</p>

      <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
        <p class="user-info">
          Conectado como: <strong><%= userName %></strong>
          <% if (typeof userCargo !== 'undefined' && userCargo) { %>
            (<%= userCargo %>)
          <% } %>
        </p>
      <% } else { %>
        <p class="login-info">
          <a href="/login">Fa√ßa login</a> ou
          <a href="/users/new">crie sua conta</a> para aproveitar mais recursos.
        </p>
      <% } %>

      <a href="/cart" class="btn-cart">Ir para o carrinho</a>
    </header>

    <section class="products-grid">

      <% produtos.forEach(function(p) { %>
        <div class="product-card">

          <% if (p.imagem) { %>
            <img src="<%= p.imagem %>" alt="<%= p.nome %>" class="product-image">
          <% } %>

          <h3 class="product-name"><%= p.nome %></h3>

          <div class="product-price">
            R$ <%= typeof p.preco === 'number' ? p.preco.toFixed(2) : p.preco %>
          </div>

          <p><strong>Tipo:</strong> <%= p.tipo || 'Outro' %></p>
          <p><strong>Estoque:</strong> <%= p.estoque || 0 %> unidades</p>
          <p class="product-description"><%= p.descricao %></p>

          <div class="product-actions">

            <% if (typeof isAuthenticated !== 'undefined' && isAuthenticated) { %>
              <form action="/cart/add" method="POST">
                <input type="hidden" name="productId" value="<%= p._id %>" />
                <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <% } %>
                <button type="submit" class="btn-primary">
                  üõí Adicionar
                </button>
              </form>
            <% } %>

            <% if (typeof userRole !== 'undefined' && (userRole === 'dono' || userRole === 'funcionario')) { %>
              <a href="/products/<%= p._id %>/edit" class="btn-secondary">‚úèÔ∏è Editar</a>

              <form action="/products/<%= p._id %>/delete" method="POST">
                <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <% } %>
                <button type="submit" class="btn-danger">üóëÔ∏è Excluir</button>
              </form>
            <% } %>

          </div>
        </div>
      <% }) %>

    </section>

    <% if (typeof userRole !== 'undefined' && (userRole === 'dono' || userRole === 'funcionario')) { %>
      <div class="add-product">
        <a href="/products/new" class="btn-add">‚ûï Adicionar novo produto</a>
      </div>
    <% } %>

  </main>

  <%- include('partials/footer') %>

</body>
</html>
